<html>
  <head>
    <title>Ludum Dare 23</title>

    <!-- Library which provides vector, matrix & quaternion classes. -->
    <script type="text/javascript" src="js/gl-matrix.js"></script>

    <!-- Library which provides WebGL setup helpers. -->
    <script type="text/javascript" src="js/webgl-utils.js"></script>

    <!-- Library which provides a seedable random number generator as a replacement for Math.random. -->
    <script type="text/javascript" src="js/seedrandom.js"></script>

    <!-- My code for this page. -->
    <script type="text/javascript" src="js/main.js"></script>

    <!-- Vertex shader. -->
    <script type="x-shader/x-vertex" id="shader-vs">
      attribute vec2 vertexPos;

      uniform mat4 worldToViewportMatrix;
      uniform float zDepth;

      void main()
      {
        vec4 worldPos = vec4(vertexPos, zDepth, 1);
        gl_Position = worldToViewportMatrix * worldPos;
        gl_PointSize = 30.0;
      }
    </script>

    <!-- Fragment shader. -->
    <script type="x-shader/x-fragment" id="shader-fs">
      precision mediump float;

      void main()
      {
        vec2 dist = vec2(0.5, 0.5) - gl_PointCoord;
        float lenSqr = dist.x * dist.x + dist.y * dist.y;
        if (lenSqr > 0.25)
          discard;
        float z = sqrt(1.0 - lenSqr);
        gl_FragColor = vec4(0, 0, z, z);
      }
    </script>

    <!-- Post-processing vertex shader. -->
    <script type="x-shader/x-vertex" id="postprocess-vs">
      attribute vec2 vertexPos;
      attribute vec2 vertexUV;

      uniform mat4 worldToViewportMatrix;

      varying vec2 vTexCoords;

      void main()
      {
        vec4 worldPos = vec4(vertexPos, 0.5, 1);
        gl_Position = worldToViewportMatrix * worldPos;
        vTexCoords = vertexUV;
      }
    </script>

    <!-- Post-processing fragment shader. -->
    <script type="x-shader/x-fragment" id="postprocess-fs">
      precision mediump float;

      uniform sampler2D texture;
      uniform vec2 dUV;

      varying vec2 vTexCoords;

      void main()
      {
        vec2 texCoord = vTexCoords;

        vec4 color00 = texture2D(texture, vec2(texCoord.x - dUV.x, texCoord.y - dUV.y));
        vec4 color01 = texture2D(texture, vec2(texCoord.x,         texCoord.y - dUV.y));
        vec4 color02 = texture2D(texture, vec2(texCoord.x + dUV.x, texCoord.y - dUV.y));
        vec4 color10 = texture2D(texture, vec2(texCoord.x - dUV.x, texCoord.y        ));
        vec4 color11 = texture2D(texture, vec2(texCoord.x,         texCoord.y        ));
        vec4 color12 = texture2D(texture, vec2(texCoord.x + dUV.x, texCoord.y        ));
        vec4 color20 = texture2D(texture, vec2(texCoord.x - dUV.x, texCoord.y + dUV.y));
        vec4 color21 = texture2D(texture, vec2(texCoord.x,         texCoord.y + dUV.y));
        vec4 color22 = texture2D(texture, vec2(texCoord.x + dUV.x, texCoord.y + dUV.y));

        vec4 vert = -color00 - 2.0 * color10 - color20 + color02 + 2.0 * color12 + color22;
        vec4 horiz = color00 + 2.0 * color01 + color02 - color20 - 2.0 * color21 - color22;

        vec4 outColor = vert + horiz;
        gl_FragColor = outColor;
      }
    </script>

    <!-- Text vertex shader. -->
    <script type="x-shader/x-vertex" id="text-vs">
      attribute vec2 vertexPos;
      attribute vec2 vertexUV;

      uniform mat4 worldToViewportMatrix;
      uniform float zDepth;

      varying vec2 vTexCoords;

      void main()
      {
        vec4 worldPos = vec4(vertexPos, zDepth, 1);
        gl_Position = worldToViewportMatrix * worldPos;
        vTexCoords = vertexUV;
      }
    </script>

    <!-- Text fragment shader. -->
    <script type="x-shader/x-fragment" id="text-fs">
      precision mediump float;

      uniform sampler2D texture;

      varying vec2 vTexCoords;

      void main()
      {
        vec4 texColor = texture2D(texture, vTexCoords);
        gl_FragColor = texColor;
      }
    </script>
  </head>
  <body onload="wtf.main();">
    <canvas id="wtf-draw-canvas" width="1024" height="512"></canvas>
    <canvas id="wtf-text-canvas" width="512" height="128" style="display: none;"></canvas>
    <hr/>
    <p>Some placeholder text.</p>
  </body>
</html>
